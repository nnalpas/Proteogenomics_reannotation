---
title: "Baccillus proteogenomics report"
author: "`r Sys.info()[['user']]`"
date: "`r format(x = Sys.time(), '%d %B %Y %T')`"
output:
    ioslides_presentation:
        css: "C:/Users/Nicolas/Documents/GitHub/Miscellaneous/R/Presentation/ioslides_custom.css"
params:
    evidences: NA
    pept.posit: NA
    levenshtein: NA
---



## Overview: feature counts per type

``` {r overview, eval = TRUE, echo = FALSE, warning = FALSE}

# Compute count of evidence per group type
data <- table(params[["evidences"]]$group) %>%
    data.frame(., type = "evidence", stringsAsFactors = FALSE) %>%
    set_names(c("group", "Freq", "type"))

# Compute count of unique peptide per group type
data <- params[["evidences"]] %>%
    dplyr::select(., Sequence, group) %>%
    dplyr::group_by(., group) %>%
    dplyr::summarise(., Freq = n_distinct(Sequence)) %>%
    data.frame(., type = "peptide", stringsAsFactors = FALSE) %>%
    rbind(data, .)

# Histogram of feature count per group type
histPlots(
    data = data,
    key = "type",
    value = "Freq",
    group = "group",
    fill = "group",
    main = "Number of evidence/peptide",
    transf = "log10")

```



## Overview: PEP per type

``` {r overview2, eval = TRUE, echo = FALSE, warning = FALSE}

# Plot evidence PEP distribution
violonPlots(
    data = params[["evidences"]],
    key = "group",
    value = "PEP",
    fill = "lightblue",
    colour = "black",
    main = "PEP comparison")

```



## Overview: Score per type

``` {r overview3, eval = TRUE, echo = FALSE, warning = FALSE}

# Plot evidence score distribution
violonPlots(
    data = params[["evidences"]],
    key = "group",
    value = "Score",
    fill = "lightblue",
    colour = "black",
    main = "Score comparison")

```



## Overview: Mass error per type

``` {r overview4, eval = TRUE, echo = FALSE, warning = FALSE}

# Calculate quantile values of evidence mass error
data <- params[["evidences"]] %>%
    dplyr::select(., group, `Mass Error [ppm]`) %>%
    base::as.data.frame(., stringsAsFactors = FALSE) %>%
    set_colnames(c("group", "mass_error"))

# Plot evidence mass error distribution
violonPlots(
    data = data,
    key = "group",
    value = "mass_error",
    fill = "lightblue",
    colour = "black",
    main = "Mass error (ppm) comparison")

```



## Novel features count

``` {r NovelCount, eval = TRUE, echo = FALSE, warning = FALSE}

# Compute novel feature count (peptide and ORF) in total
data <- params[["pept.posit"]] %>%
    dplyr::summarise(
        .,
        type = "All novel",
        Number_peptide = n_distinct(Sequence),
        Number_ORF = n_distinct(ORF)) %>%
    tidyr::gather(
        data = ., key = "feature", value = "Count", -type) %>%
    base::as.data.frame(., stringsAsFactors = FALSE)

# Compute novel feature count (peptide and ORF) that pass PEP filter 
data <- params[["pept.posit"]] %>%
    dplyr::filter(., ReasonNovel != "PEPfilter") %>%
    dplyr::summarise(
        .,
        type = "PEP filtered",
        Number_peptide = n_distinct(Sequence),
        Number_ORF = n_distinct(ORF)) %>%
    tidyr::gather(
        data = ., key = "feature", value = "Count", -type) %>%
    base::as.data.frame(., stringsAsFactors = FALSE) %>%
    rbind(data, .)

# Plot the novel feature count
histPlots(
    data = data,
    key = "feature",
    value = "Count",
    group = "type",
    fill = "type",
    main = "Novel peptide/ORF count")

```



## Levenshtein distance for SAV peptide

``` {r levenshtein, eval = TRUE, echo = FALSE, warning = FALSE}

# Compute the peptide count per levenshtein distance
data <- params[["levenshtein"]] %>%
    dplyr::select(., Sequence, leven) %>%
    unique(.) %>%
    dplyr::group_by(., leven) %>%
    dplyr::summarise(., count = n()) %>%
    base::as.data.frame(., stringsAsFactors = FALSE)

# Plot the levenshtein distance count
histPlots(
    data = data,
    key = "leven",
    value = "count",
    group = "leven",
    fill = "leven",
    main = "Levenshtein distance density",
    textsize = 15)

```



## Novel peptide reason explanation

``` {r NovelReason, eval = TRUE, echo = FALSE, warning = FALSE}

# Compute the peptide count per novelty reasons
data <- params[["pept.posit"]] %>%
    dplyr::filter(., ReasonNovel != "PEPfilter") %>%
    dplyr::group_by(., ReasonNovel) %>%
    dplyr::summarise(
        .,
        Number_peptide = n_distinct(Sequence),
        Number_ORF = n_distinct(ORF)) %>%
    tidyr::gather(
        data = ., key = "feature", value = "Count", -ReasonNovel) %>%
    base::as.data.frame(., stringsAsFactors = FALSE)

# Plot the feature count per novelty reasons
histPlots(
    data = data,
    key = "feature",
    value = "Count",
    group = "ReasonNovel",
    fill = "ReasonNovel",
    main = "Peptide novelty reasons")

```


