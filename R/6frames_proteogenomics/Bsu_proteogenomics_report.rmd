---
title: "Baccillus proteogenomics report"
author: "`r Sys.info()[['user']]`"
date: "`r format(x = Sys.time(), '%d %B %Y %T')`"
output:
    ioslides_presentation:
        self_contained: FALSE
        css: "C:/Users/kxmna01/Documents/GitHub/Miscellaneous/R/Presentation/ioslides_custom.css"
params:
    evidences: NA
    pept.posit: NA
    levenshtein: NA
---



## Overview: feature counts per type

``` {r overview, eval = TRUE, echo = FALSE, warning = FALSE}

# Compute count of evidence per group type
data <- table(params[["evidences"]]$group) %>%
    data.frame(., type = "evidence", stringsAsFactors = FALSE) %>%
    set_names(c("group", "Freq", "type"))

# Compute count of unique peptide per group type
data <- params[["evidences"]] %>%
    dplyr::select(., Sequence, group) %>%
    dplyr::group_by(., group) %>%
    dplyr::summarise(., Freq = n_distinct(Sequence)) %>%
    data.frame(., type = "peptide", stringsAsFactors = FALSE) %>%
    rbind(data, .)

# Histogram of feature count per group type
pl <- histPlots(
    data = data,
    key = "type",
    value = "Freq",
    group = "group",
    fill = "group",
    main = "Number of evidence/peptide",
    transf = "log10")
plotly::plotly_build(pl[[1]])

```



## Overview: PEP per type

``` {r overview2, eval = TRUE, echo = FALSE, warning = FALSE}

# Plot evidence PEP distribution
pl <- violonPlots(
    data = params[["evidences"]],
    key = "group",
    value = "PEP",
    fill = "lightblue",
    colour = "black",
    main = "PEP comparison")
pl[[1]]

```



## Overview: Score per type

``` {r overview3, eval = TRUE, echo = FALSE, warning = FALSE}

# Plot evidence score distribution
pl <- violonPlots(
    data = params[["evidences"]],
    key = "group",
    value = "Score",
    fill = "lightblue",
    colour = "black",
    main = "Score comparison")
pl[[1]]

```



## Overview: Mass error per type

``` {r overview4, eval = TRUE, echo = FALSE, warning = FALSE}

# Calculate quantile values of evidence mass error
data <- params[["evidences"]] %>%
    dplyr::select(., group, `Mass Error [ppm]`) %>%
    base::as.data.frame(., stringsAsFactors = FALSE) %>%
    set_colnames(c("group", "mass_error"))

# Plot evidence mass error distribution
pl <- violonPlots(
    data = data,
    key = "group",
    value = "mass_error",
    fill = "lightblue",
    colour = "black",
    main = "Mass error (ppm) comparison")
pl[[1]]

```



## Novel features count

``` {r NovelCount, eval = TRUE, echo = FALSE, warning = FALSE}

# Compute novel feature count (peptide and ORF) in total
data <- params[["pept.posit"]] %>%
    dplyr::summarise(
        .,
        type = "All novel",
        Number_peptide = n_distinct(Sequence),
        Number_ORF = n_distinct(ORF)) %>%
    tidyr::gather(
        data = ., key = "feature", value = "Count", -type) %>%
    base::as.data.frame(., stringsAsFactors = FALSE)

# Compute novel feature count (peptide and ORF) that pass PEP filter 
data <- params[["pept.posit"]] %>%
    dplyr::filter(., ReasonNovel != "PEPfilter") %>%
    dplyr::summarise(
        .,
        type = "PEP filtered",
        Number_peptide = n_distinct(Sequence),
        Number_ORF = n_distinct(ORF)) %>%
    tidyr::gather(
        data = ., key = "feature", value = "Count", -type) %>%
    base::as.data.frame(., stringsAsFactors = FALSE) %>%
    rbind(data, .)

# Plot the novel feature count
pl <- histPlots(
    data = data,
    key = "feature",
    value = "Count",
    group = "type",
    fill = "type",
    main = "Novel peptide/ORF count")
plotly::plotly_build(pl[[1]])

```



## Levenshtein distance for SAV peptide

``` {r levenshtein, eval = TRUE, echo = FALSE, warning = FALSE}

# Compute the peptide count per levenshtein distance
data <- params[["levenshtein"]] %>%
    dplyr::select(., Sequence, leven) %>%
    unique(.) %>%
    dplyr::group_by(., leven) %>%
    dplyr::summarise(., count = n()) %>%
    base::as.data.frame(., stringsAsFactors = FALSE)

# Plot the levenshtein distance count
pl <- histPlots(
    data = data,
    key = "leven",
    value = "count",
    group = "leven",
    fill = "leven",
    main = "Levenshtein distance density",
    textsize = 15)
plotly::plotly_build(pl[[1]])

```



## Novel peptide reason explanation

``` {r NovelReason, eval = TRUE, echo = FALSE, warning = FALSE}

# Compute the peptide count per novelty reasons
data <- params[["pept.posit"]] %>%
    dplyr::filter(., ReasonNovel != "PEPfilter") %>%
    dplyr::group_by(., ReasonNovel) %>%
    dplyr::summarise(
        .,
        Number_peptide = n_distinct(Sequence),
        Number_ORF = n_distinct(ORF)) %>%
    tidyr::gather(
        data = ., key = "feature", value = "Count", -ReasonNovel) %>%
    base::as.data.frame(., stringsAsFactors = FALSE)

# Plot the feature count per novelty reasons
pl <- histPlots(
    data = data,
    key = "feature",
    value = "Count",
    group = "ReasonNovel",
    fill = "ReasonNovel",
    main = "Peptide novelty reasons")
plotly::plotly_build(pl[[1]])

```



## ORF density per novel peptide count

``` {r PepCount, eval = TRUE, echo = FALSE, warning = FALSE}

# Compute count of unique peptide per ORF (to see which ORF
# have multiple peptide evidence)
novelty <- unique(params[["pept.posit"]]$ReasonNovel)[-1]
data <- data.frame()
for (key in novelty) {
    
    filt <- params[["pept.posit"]] %>%
        dplyr::filter(., ReasonNovel == key) %>%
        .[["ORF"]]
    data <- params[["pept.posit"]] %>%
        dplyr::filter(., ORF %in% filt) %>%
        dplyr::group_by(., ORF) %>%
        dplyr::summarise(., Unique_peptide_count = n_distinct(Sequence)) %>%
        dplyr::group_by(., Unique_peptide_count) %>%
        dplyr::summarise(., ORF_count = n_distinct(ORF)) %>%
        base::data.frame(., Novelty = key, stringsAsFActors = FALSE) %>%
        rbind(data, .)
    
}

# Plot the ORF frequency per matching peptide count
pl <- histPlots(
    data = data,
    key = "Unique_peptide_count",
    value = "ORF_count",
    group = "Novelty",
    fill = "Novelty",
    main = "Novel ORF density per novel peptide count")
plotly::plotly_build(pl[[1]])

```


